<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BLOG</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" href="/styles.css">
  </head>
<body>
  

<div id="nav">
    <a href="/login">Log-in</a>
    <a href="/register">Register</a>
  </div>
  
  
 <div class="container">
  <h1>My Node Blog</h1>
  
   <h2>All Published Posts</h2>
      
  <p><a href="/login">Log-in</a> to edit</p>
 
  

  <!---TESTING---->
    <%
   
  for(i=0; i< result.length;i++){
     //console.log(result[i].username)
    console.log(result[i].posts)
    
    let posts = result[i].posts
    //console.log(posts)
    
        for(j=0; j< result[i].posts.length;j++){
          
            //console.log(result[i].posts[j].title)
           // console.log(result[i].posts[j].status)
  }
  }
      %>
  
  
  <!------DISPLAY ALL PUBLISHED POSTS ON HOMEPAGE---->
     <ul>

    <% for(i=0; i< result.length;i++){ %>
       
     <%  let posts = result[i].posts %>
       
     <%  for(j=0; j< result[i].posts.length;j++){ %>
       
       <%  let status = result[i].posts[j].status %>
       
       <%  let tag = result[i].posts[j].tag %>
       
       <!------EXCLUDE DRAFTS---->
<%  if (status == "published") { %>
       
       <!------TRIM POST CONTENT---->
       <% let postContent = result[i].posts[j].content %>
        <%  var length = 300; %>
       <% var trimmedpostContent = postContent.substring(0, length); %>

      <li><div>
        <p class="postTitle"> <%= result[i].posts[j].title %></p><br>
        <input hidden name="postID" type="text" readonly value= <%= result[i].posts[j]._id %> > <br> 
         <p class="postContent"><%= trimmedpostContent %>
         
         <form method="POST" action="/singlePost">
           <input hidden type="text" placeholder="username" name="postTitle" value= <%= result[i].posts[j].title %>>
            <input hidden name="postID" type="text" value= <%= result[i].posts[j]._id %> > 
              <input class="btn" name type="submit" value="... Read More"></input> 
          </form>
        
        <p class="postTag">Tag:<i> <%= result[i].posts[j].tag %></p></i></p>
        <p class="postStatus">Status:<i> <%= result[i].posts[j].status %></p></i></p>
        </div>
          </li>

      <% } %>
    <% } %>
   <% } %> 

  </ul>

    
  </ul>
  </div>
  
  </body>

  
</html>